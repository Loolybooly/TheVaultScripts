-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Player
local player = Players.LocalPlayer
local dodge = false
local dodgeUp = false
local dodgeDistance = 10
local dodgeUpDistance = 15
local espEnabled = false
local espObjects = {}
local noclip = false
local flyEnabled = false
local flySpeed = 50
local flying = false
local killAuraEnabled = false
local gloveReachExtenderEnabled = false
local antiRagdollEnabled = false

-- GUI (Rayfield)
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Window = Rayfield:CreateWindow({
    Name = "Slap Battles",
    LoadingTitle = "By The Vault Scripts",
    LoadingSubtitle = "Coded by Muye & Looly",
    Theme = "Default",
})

local Tab = Window:CreateTab("Main", 4483362458)

-- Discord Invite Button
Tab:CreateSection("Discord")
Tab:CreateButton({
    Name = "Copy Discord Link",
    Callback = function()
        setclipboard("https://discord.gg/NUsQx6pnyQ")
    end,
})

-- Special Features
Tab:CreateSection("Special Features")

-- Anti-Ragdoll Toggle
Tab:CreateToggle({
    Name = "Anti Ragdoll",
    CurrentValue = false,
    Callback = function(state)
        antiRagdollEnabled = state
        local character = player.Character
        if character and antiRagdollEnabled then
            local humanoid = character:WaitForChild("Humanoid")
            humanoid.Died:Connect(function()
                humanoid:ChangeState(Enum.HumanoidStateType.Physics)
            end)
        end
    end,
})

-- Glove Reach Extender Toggle
Tab:CreateToggle({
    Name = "Glove Reach Extender",
    CurrentValue = false,
    Callback = function(state)
        gloveReachExtenderEnabled = state
    end,
})

-- Kill Aura Toggle
Tab:CreateToggle({
    Name = "Kill Aura",
    CurrentValue = false,
    Callback = function(state)
        killAuraEnabled = state
    end,
})

-- Slapple Farm
Tab:CreateSection("Slapple Farm")
Tab:CreateToggle({
    Name = "Slapple Farm",
    CurrentValue = false,
    Callback = function(state)
        getgenv().slapfarmspissb = state
        if state then
            task.spawn(function()
                while getgenv().slapfarmspissb do
                    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        for _, v in pairs(workspace.Arena.island5.Slapples:GetDescendants()) do
                            if v.Name == "Glove" and v:FindFirstChild("TouchInterest") then
                                firetouchinterest(hrp, v, 0)
                                firetouchinterest(hrp, v, 1)
                            end
                        end
                    end
                    task.wait(1)
                end
            end)
        end
    end,
})

-- ESP
Tab:CreateSection("ESP")
Tab:CreateToggle({
    Name = "ESP",
    CurrentValue = false,
    Callback = function(state)
        espEnabled = state

        -- Clear old ESP
        for _, objs in pairs(espObjects) do
            for _, obj in ipairs(objs) do
                obj:Destroy()
            end
        end
        espObjects = {}

        if state then
            RunService:BindToRenderStep("ESP", Enum.RenderPriority.Camera.Value + 1, function()
                for _, plr in pairs(Players:GetPlayers()) do
                    if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                        local hrp = plr.Character.HumanoidRootPart
                        if not espObjects[plr] then
                            espObjects[plr] = {}

                            -- Glove label
                            local gloveBill = Instance.new("BillboardGui", hrp)
                            gloveBill.Size = UDim2.new(0, 200, 0, 50)
                            gloveBill.StudsOffset = Vector3.new(0, 4, 0)
                            gloveBill.AlwaysOnTop = true
                            local gloveText = Instance.new("TextLabel", gloveBill)
                            gloveText.Size = UDim2.new(1, 0, 1, 0)
                            gloveText.BackgroundTransparency = 1
                            gloveText.TextColor3 = Color3.new(1, 0, 0)
                            gloveText.TextStrokeTransparency = 0
                            gloveText.TextScaled = false
                            gloveText.Font = Enum.Font.SourceSansBold
                            gloveText.TextSize = 18
                            gloveText.Text = plr.leaderstats and plr.leaderstats.Glove and plr.leaderstats.Glove.Value or "Loading"
                            table.insert(espObjects[plr], gloveBill)

                            -- Name label
                            local nameBill = Instance.new("BillboardGui", hrp)
                            nameBill.Size = UDim2.new(0, 200, 0, 50)
                            nameBill.StudsOffset = Vector3.new(0, 3, 0)
                            nameBill.AlwaysOnTop = true
                            local nameText = Instance.new("TextLabel", nameBill)
                            nameText.Size = UDim2.new(1, 0, 1, 0)
                            nameText.BackgroundTransparency = 1
                            nameText.TextColor3 = Color3.new(1, 1, 1)
                            nameText.TextStrokeTransparency = 0
                            nameText.TextScaled = false
                            nameText.Font = Enum.Font.SourceSans
                            nameText.TextSize = 14
                            nameText.Text = plr.DisplayName
                            table.insert(espObjects[plr], nameBill)

                            -- Red square
                            local box = Instance.new("BoxHandleAdornment", hrp)
                            box.Size = Vector3.new(2, 3, 1)
                            box.Color3 = Color3.new(0.5, 0, 0)
                            box.Transparency = 0
                            box.AlwaysOnTop = true
                            box.Adornee = hrp
                            table.insert(espObjects[plr], box)
                        end
                    end
                end
            end)
        else
            RunService:UnbindFromRenderStep("ESP")
        end
    end,
})

-- Dodge
Tab:CreateSection("Dodge")
Tab:CreateToggle({
    Name = "Dodge (Press Q)",
    CurrentValue = false,
    Callback = function(value)
        dodge = value
    end,
})
Tab:CreateInput({
    Name = "Dodge Distance",
    PlaceholderText = tostring(dodgeDistance),
    Callback = function(text)
        dodgeDistance = tonumber(text) or 10
    end,
})

-- Dodge Up
Tab:CreateToggle({
    Name = "Dodge Up (Press Z)",
    CurrentValue = false,
    Callback = function(value)
        dodgeUp = value
    end,
})
Tab:CreateInput({
    Name = "Dodge Up Distance",
    PlaceholderText = tostring(dodgeUpDistance),
    Callback = function(text)
        dodgeUpDistance = tonumber(text) or 15
    end,
})

-- Teleport
Tab:CreateSection("Teleport")
for name, _ in pairs(teleportLocations) do
    Tab:CreateButton({
        Name = "Teleport to " .. name,
        Callback = function()
            teleportToLocation(name)
        end,
    })
end

-- Input Handler for Dodge & Fly
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.Q and dodge then
        local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        if hrp then
            hrp.CFrame = hrp.CFrame + hrp.CFrame.LookVector * dodgeDistance
        end
    elseif input.KeyCode == Enum.KeyCode.Z and dodgeUp then
        local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        if hrp then
            hrp.CFrame = hrp.CFrame + Vector3.new(0, dodgeUpDistance, 0)
        end
    end
end)

-- Copy Discord Link to Clipboard
local copyDiscordLinkButton = Tab:CreateButton({
    Name = "Copy Discord Link",
    Callback = function()
        setclipboard("https://discord.gg/NUsQx6pnyQ")
    end,
})
